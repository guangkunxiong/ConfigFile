" ==========================================
" 基础设置 (Basic Settings)
" ==========================================
let mapleader = " "        " Leader键设为空格
set scrolloff=5            " 光标距离底部5行时就开始滚动
set hlsearch               " 高亮搜索
set incsearch              " 增量搜索
set ignorecase             " 忽略大小写
set smartcase              " 智能大小写
set showmode               " 显示当前模式
set clipboard+=unnamed     " 使用系统剪贴板

" ==========================================
" 插件开启 (Plugins)
" ==========================================
" 确保你在 IDEA 设置 > Plugins 里安装了 IdeaVim, IdeaVim-EasyMotion, IdeaVim-Sneak
set easymotion
set surround
set multiple-cursors
set commentary             " 推荐：开启 gc 注释功能
set sneak                  " 开启 Sneak

" ==========================================
" 键位映射 (Key Mappings)
" ==========================================

" --- 1. 核心生存法则 ---
" 秒退 Insert 模式
inoremap jj <Esc>
inoremap jk <Esc>

" 行首行尾强行跳转
nnoremap H ^
nnoremap L $
vnoremap H ^
vnoremap L $

" 清除搜索高亮 (<Space>ns)
nnoremap <leader>ns :nohlsearch<CR>

" 保存文件 (<Space>fs)
nnoremap <leader>fs :action SaveAll<CR>

" --- 2. 标签页与文件跳转 ---
" 左右切换标签页 (<Space>j / <Space>k)
nnoremap <leader>j :action PreviousTab<CR>
nnoremap <leader>k :action NextTab<CR>

" 关闭当前标签页 (<Space>wc) - 放在窗口管理里也可以，但在IDEA里通常是关闭Tab
nnoremap <leader>wc :action CloseContent<CR>

" 文件搜索 (<Space>ff -> Cmd+P)
nnoremap <leader>ff :action GotoFile<CR>
" 全局搜索 (<Space>ss -> Cmd+Shift+F)
nnoremap <leader>ss :action FindInPath<CR>
" 打开侧边栏 (<Space>e)
nnoremap <leader>e :action SelectInProjectView<CR>
" 最近文件 (<Space>r) - 既然用了ff，这个可选
nnoremap <leader>fr :action RecentFiles<CR>

" --- 3. 窗口管理 (Split Windows) ---
" 竖向拆分 (<Space>wv)
nnoremap <leader>wv :action SplitVertically<CR>
" 横向拆分 (<Space>ws)
nnoremap <leader>ws :action SplitHorizontally<CR>
" 在窗口间循环切换 (<Space>ww)
nnoremap <leader>ww :action NextSplitter<CR>
" 关闭当前分割窗口 (<Space>wd)
nnoremap <leader>wd :action Unsplit<CR>

" --- 4. 代码重构与操作 ---
" 格式化整个文件 (<Space>=)
nnoremap <leader>= :action ReformatCode<CR>
" 重命名 (<Space>r)
nnoremap <leader>r :action RenameElement<CR>
" 跳转定义 (gd) - IdeaVim 默认支持，或者显式映射
nnoremap gd :action GotoDeclaration<CR>
" 查看引用 (gr)
nnoremap gr :action FindUsages<CR>
" 跳转实现 (gi)
nnoremap gi :action GotoImplementation<CR>

" --- 5. EasyMotion 配置 ---
" 映射 <Space>j 为 EasyMotion 跳转 (和 VS Code 保持一致)
" 注意：IdeaVim-EasyMotion 默认前缀是 <Leader><Leader>
map <leader>j <Plug>(easymotion-s)

" --- 6. Sneak 改键 (把 z 变成 Sneak，把 s 还原) ---
" 映射 z 为 Sneak (向前)
map z <Plug>Sneak_s
" 映射 Z 为 Sneak (向后)
map Z <Plug>Sneak_S

" 把 s 还原为 cl (修改字符) - 因为 Sneak 默认占用了 s
map s cl
map S cc

" --- 7. 历史跳转 ---
" 跳回上一次修改位置 (gb)
nnoremap gb :action JumpToLastChange<CR>
" 前进/后退 (Ctrl+o/i) - IdeaVim 默认支持，显式映射防冲突
nnoremap <C-o> :action Back<CR>
nnoremap <C-i> :action Forward<CR>

" ==========================================
" 输入法切换 (Mac)
" ==========================================
" 需要在 IDEA 设置 > Editor > Vim > Smart Input 开启，或者使用下面的配置
set keep-english-in-normal-and-restore-in-insert
